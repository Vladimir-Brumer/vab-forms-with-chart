# vab-forms-with-chart
<p>«Forms with chart from VAB» - легкий и простой плагин для создания форм, анкет и опросников с возможностью вывода результатов в виде диаграмм.</p>
<p>«Forms with chart from VAB» может управлять многочисленными контактными формами, где вы можете гибко настраивать содержимое форм с достаточно простой разметкой. Формы имеют встроенную защиту от спама и не только.</p>
<p>Основное направление плагина это опросы и анкеты с выводом результатов в виде диаграмм таких полей как «Флажки», «Радиокнопки», «Выпадающий список» на чистом css, но подходит и для создание других вариантов форм обратной связи, в том числе с возможностью отправки вложений, а также записи данных в файлы CSV. Более подробно с работой плагина можно  ознакомиться по ссылке - <a href="https://vi.it-vab.ru/контакты/формы-опросы-анкеты-с-выводом-диаграм/" target="_blank" rel="noopener">Тема для WordPress с наличием Версии для слабовидящих. Обзор темы (3в1)</a>.</p>
<p>В конфигурации по умолчанию этот плагин сам по себе не выполняет:</p>
<ul class="ul">
<li>отслеживать пользователей скрытно;</li>
<li>записывать любые персональные данные пользователя в базу данных;</li>
<li>отправлять любые данные на внешние серверы;</li>
<li>использовать файлы cookie.</li>
</ul>
<p>В настройках формы вы можете активировать действия плагина:</p>
<ul class="ul">
<li>записывает введенные данные формы в файл для отображения результатов диаграмм;</li>
<li>отключать / включать запись в лог файлы даты, IP адреса и пользовательского агента.</li>
</ul>
<p><strong style="color: #ff0000;">Важно!!!</strong> Не рекомендуется включать запись в лог файлы персональных данных на серверах, где не работают .htaccess файлы, не убедившись в корректности настроек веб сервера (для этого Вы можете связаться с хостинг провайдером, либо протестировать файлы txt в таблице «Информация для администратора», активировав опцию «<span class="ch">Блокировать доступ к лог файлам с помощью htaccess</span>» в настройках формы, при этом не забывая о кешировании браузера), чтобы эти данные не оказались в открытом доступе (Например, сервер Nginx + php-fpm).</p>
<p><strong>.htaccess</strong> — это конфигурационный файл веб-сервера Apache, позволяющий управлять работой веб-сервера и настройками сайта с помощью различных параметров (директив) без изменения основного конфигурационного файла веб-сервера.</p>
<ul class="ul">
Version: 1.1.5
<li>Добавлены фильтры для возможности добавления (проверки) полей, а также вывода сообщения</li>
<li>Добавлена опция, благодаря которой диаграммы отображаются только для администраторов;</li>
</ul>
<ul class="ul">
Фильтры:
<li>VABFWC_validate_filter - Возвращает либо true(истина), либо false(ложь). Если по какому-либо условию возвращается true (истина), форма остановит работу(сообщение не будет отправлено)</li>
 <li>VABFWC_fields_filter - Возвращает строку для вывода на экран. Разрешен Элемент HTML input с атрибутами «type», «id», «class», «name», «value», «checked», «onfocus», «onchange»</li>
 <li>VABFWC_message_filter - Возвращает строку для вывода на экран как текст(сообщение)</li>
 <li>VABFWC_message_after_filter — Возвращает строку для вывода на экран как текст(сообщение). Срабатывает после успешной отправки электронного сообщения.</li>
</ul>
Как использовать фильтры?

<ul class="ul">
<li>
VABFWC_fields_filter. Код ниже добавит скрытое поле за счет стилей через класс «formInput», которое будет со значением по умолчанию «WordPress». Будет выведен только тег «input» без «label» (см. описание выше для VABFWC_fields_filter).
</li>
 

```
add_filter( 'VABFWC_fields_filter', 'VABFWC_fields_filter', 10 );
if ( !function_exists(	'VABFWC_fields_filter'	) ){
 function VABFWC_fields_filter( $str ){
  $str	= '<label for="new_field" >' .
           '<input id="new_field" name="new_field" type="text" class="formInput" value="WordPress"/>' .
          '</label>';
  return $str;
 }}
``` 
 
<li>
VABFWC_validate_filter. Код ниже остановить отправку формы, если хоть одно условие вернет «true» (истину).
 <ol>
<li>Первое условие проверяет наличие установленной «cookie» со значением «agree». Предположим у Вас на сайте есть кнопка «Я согласен», при нажатии на которую устанавливается «cookie» со значением «agree», что означает, что пользователь дал согласие на использование «cookie». Таким образом пока пользователь не нажмет кнопку «Я согласен», форма не будет работать, кроме того и усложнится жизнь ботам.
</li>
<li>
 Второе условие проверяет значение скрытого поля, если оно отлично от значения по умолчаниею ( «WordPress» ), дальнейшая обработка формы будет остановлена.
</li>
</ol>
</li>
 

``` 
add_filter( 'VABFWC_validate_filter', 'VABFWC_filter_function', 10 );
if ( !function_exists( 'VABFWC_filter_function' ) ) {
 function VABFWC_filter_function( $str ){
  if ( !isset( $_COOKIE['my_cookie_agree'] ) || $_COOKIE['my_cookie_agree'] !== 'agree'	) { // Первое условие
   return true;
  }
  if ( sanitize_text_field( $_POST['new_field'] ) !== 'WordPress' ) { // Второе условие
   return true;
  }
 }}
``` 
 
<li>
VABFWC_message_filter. Если «cookie» со значением «agree» не будет присутствовать (пользователь не дал согласие на использование «cookie»), код ниже выведет сообщение пользователю.
</li>
 

```
add_filter( 'VABFWC_message_filter', 'VABFWC_message_filter', 10 );
if ( !function_exists(	'VABFWC_message_filter' ) ){
 function VABFWC_message_filter( $str ){
  if ( !isset( $_COOKIE['my_cookie_agree'] ) || $_COOKIE['my_cookie_agree'] !== 'agree'	) {
   return $str = esc_html__( 'Использование cookie отключено в настройках безопасности Вашего браузера, либо не дано согласие на их использование', 'VAB' );
  }
 }}
``` 
 
 <li>
VABFWC_message_after_filter. После успешной отправки электронного письма мы можем выполнить какие-либо свои подсчеты и вывести их результаты на экран
</li>
 
 ```
add_filter( 'VABFWC_message_after_filter', 'VABFWC_message_after_filter', 10 );
if ( !function_exists('VABFWC_message_after_filter') ){
    function VABFWC_message_after_filter( $str ){
     global $post;
     if ( $post->ID == 11057 ) {
        // do something
        $str .= 'Hellow';

     }
     if ( $post->ID == 11052 ) {
        // do something
        $str .= 'World';
     }
        return $str ;
}}
 ```
</ul>

Если необходимо добавить фильтры для конкретной формы, Мы можем использовать глобальную переменную «post» и проверить идентификатор записи/страницы:

``` 
add_filter( 'VABFWC_validate_filter', 'my_filter_function', 10 );
function my_filter_function( $str ){
 global $post;
 if ( $post->ID == 1652 ) {
  if ( !isset( $_COOKIE['my_cookie_agree'] ) || $_COOKIE['my_cookie_agree'] !== 'agree' ) {
   return true;
  }}}
``` 